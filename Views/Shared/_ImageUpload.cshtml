@model string

@{
    var inputId = ViewData["InputId"] as string ?? "ImageUrl";
    var inputName = ViewData["InputName"] as string ?? "ImageUrl";
    var label = ViewData["Label"] as string ?? "Ảnh đại diện";
    var currentImage = Model;
}

<div class="image-upload-container">
    <label class="form-label fw-bold">@label</label>
    
    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="imageTab@(inputId)" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="url-tab-@(inputId)" data-bs-toggle="tab" data-bs-target="#url-pane-@(inputId)" type="button" role="tab">
                <i class="fas fa-link me-1"></i>URL
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="upload-tab-@(inputId)" data-bs-toggle="tab" data-bs-target="#upload-pane-@(inputId)" type="button" role="tab">
                <i class="fas fa-upload me-1"></i>Upload
            </button>
        </li>
    </ul>
    
    <!-- Tab Content -->
    <div class="tab-content" id="imageTabContent@(inputId)">
        <!-- URL Tab -->
        <div class="tab-pane fade show active" id="url-pane-@(inputId)" role="tabpanel">
            <input type="text" id="@(inputId)" name="@(inputName)" class="form-control image-url-input" 
                   placeholder="https://..." value="@currentImage" />
            <div class="form-text">Nhập URL ảnh từ internet</div>
        </div>
        
        <!-- Upload Tab -->
        <div class="tab-pane fade" id="upload-pane-@(inputId)" role="tabpanel">
            <input type="file" id="@(inputId)_file" name="@(inputName)_file" class="form-control image-file-input" 
                   accept="image/*" />
            <div class="form-text">Chọn file ảnh từ máy tính (jpg, png, gif, webp - tối đa 5MB)</div>
        </div>
    </div>
    
    <!-- Image Preview -->
    <div class="image-preview mt-3" id="preview-@(inputId)" style="@(string.IsNullOrEmpty(currentImage) ? "display:none;" : "")">
        <img src="@currentImage" class="img-thumbnail" style="max-height: 200px;" id="img-preview-@(inputId)" />
    </div>
</div>

<style>
    .image-upload-container {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        background: #f8f9fa;
    }
    
    .image-upload-container .nav-tabs .nav-link {
        color: #6c757d;
    }
    
    .image-upload-container .nav-tabs .nav-link.active {
        color: #2E7D32;
        font-weight: 600;
    }
</style>

<script>
    (function() {
        var inputId = '@(inputId)';
        var urlInput = document.getElementById(inputId);
        var fileInput = document.getElementById(inputId + '_file');
        var preview = document.getElementById('preview-' + inputId);
        var imgPreview = document.getElementById('img-preview-' + inputId);
        
        // Xử lý khi nhập URL
        if (urlInput) {
            urlInput.addEventListener('input', function() {
                var url = this.value;
                if (url) {
                    imgPreview.src = url;
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            });
        }
        
        // Xử lý khi chọn file
        if (fileInput) {
            fileInput.addEventListener('change', function() {
                var file = this.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        imgPreview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    })();
</script>
